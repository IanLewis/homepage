# vim: ft=yaml

# NOTE: vars are included in the all group so that they are available to all
#       hosts and roles.

# Homepage App

app_mysql_host: "localhost"
app_mysql_port: 3306
app_secret_key: ""
app_disqus_api_key: ""
app_disqus_website_shortname: ""
app_port: 8000

# MySQL

mysql_db:
  - name: homepage
    replicate: no

mysql_users:
  - name: homepage
    pass: "{{ lookup('password', playbook_dir + '/credentials/mysqlpassword length=15') }}"
    priv: "*.*:ALL"

# Nginx

nginx_http_params:
  sendfile: "on"                                      
  tcp_nopush: "on"
  tcp_nodelay: "on"
  keepalive_timeout: "65"

nginx_sites:
 - server:
    file_name: homepage
    listen: 80
    server_name: www.ianlewis.org

    # TODO: Fix static paths
    location1:
      name: "~ ^/(robots\\.txt|favicon\\.ico)$"
      root: "/var/www/venvs/homepage/lib/python2.7/site-packages/homepage/site_media/static/extra"

    location2:
      name: "~ ^/(img|css|js|lib|files|filebrowser)/"
      root: "/var/www/venvs/homepage/lib/python2.7/site-packages/homepage/site_media/static"

    location3:
        name: "/media"
        # TODO: Make media directory a variable
        alias: "/var/www/media"

    location4:
      name: "/static"
      alias: "/var/www/venvs/homepage/lib/python2.7/site-packages/homepage/site_media/static"

    location5: 
      name: "/"
      proxy_redirect: "off"
      proxy_set_header: "X-Forwarded-Host $host"
      proxy_cache_min_uses: "3"
      proxy_next_upstream: "error timeout invalid_header"
      client_max_body_size: "10m" 
      client_body_buffer_size: "128k"
      proxy_connect_timeout: "90"
      proxy_send_timeout: "90"
      proxy_read_timeout: "90" 
      proxy_pass: "http://localhost:{{ app_port }}"

# TODO: Add default host?
